{
  "name": "Excel Contact Automation with Manual Trigger",
  "nodes": [
    {
      "parameters": {
        "mode": "manual",
        "binaryData": true,
        "binaryProperties": ["sourceFile", "targetFile"],
        "manualParameters": {
          "sourceLinkedinCol": {
            "type": "string",
            "default": "Linkedin Profile URL"
          },
          "targetSheet": {
            "type": "string",
            "default": "Sheet1"
          },
          "targetLinkedinCol": {
            "type": "string",
            "default": "LinkedIn"
          },
          "finalEmailCol": {
            "type": "string",
            "default": "Final Email"
          },
          "firstNameCol": {
            "type": "string",
            "default": "First Name"
          },
          "lastNameCol": {
            "type": "string",
            "default": "Last Name"
          },
          "companyIdCol": {
            "type": "string",
            "default": "CompanyID"
          }
        }
      },
      "name": "Start Workflow",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [240, 300],
      "notes": "Upload 'sourceFile' (contacts) and 'targetFile' (LinkedIn comparison) Excel workbooks here. Specify column names in the form."
    },
    {
      "parameters": {
        "fileName": "temp_source_{{new Date().toISOString()}}.xlsx",
        "binaryPropertyName": "sourceFile",
        "options": {}
      },
      "name": "Write Source Temp File",
      "type": "n8n-nodes-base.writeBinaryFile",
      "typeVersion": 1,
      "position": [400, 300]
    },
    {
      "parameters": {
        "fileName": "temp_target_{{new Date().toISOString()}}.xlsx",
        "binaryPropertyName": "targetFile",
        "options": {}
      },
      "name": "Write Target Temp File",
      "type": "n8n-nodes-base.writeBinaryFile",
      "typeVersion": 1,
      "position": [400, 460]
    },
    {
      "parameters": {
        "operation": "read",
        "filePath": "{{$node['Write Source Temp File'].json['fileName']}}",
        "sheetName": "Sheet1"
      },
      "name": "Read Source Excel",
      "type": "n8n-nodes-base.spreadsheetFile",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "operation": "read",
        "filePath": "{{$node['Write Target Temp File'].json['fileName']}}",
        "sheetName": "{{$node['Start Workflow'].json['targetSheet']}}"
      },
      "name": "Read Target Excel",
      "type": "n8n-nodes-base.spreadsheetFile",
      "typeVersion": 1,
      "position": [460, 460]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "pythonCode": "source = $node['Read Source Excel'].json\ntarget = $node['Read Target Excel'].json\nlinkedin_col = $node['Start Workflow'].json['sourceLinkedinCol']\ntarget_col = $node['Start Workflow'].json['targetLinkedinCol']\nreturn [row for row in source if not any(t.get(target_col) == row.get(linkedin_col) for t in target)]"
      },
      "name": "Remove Duplicates",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [680, 300]
    },
    {
      "parameters": {
        "operation": "write",
        "filePath": "source_v1_DuplicatesRemoved_{{new Date().toISOString()}}.xlsx",
        "sheetName": "DuplicatesRemoved"
      },
      "name": "Write Duplicates Removed",
      "type": "n8n-nodes-base.spreadsheetFile",
      "typeVersion": 1,
      "position": [900, 300]
    },
    {
      "parameters": {
        "operation": "read",
        "filePath": "{{$node['Write Duplicates Removed'].json['filePath']}}",
        "sheetName": "DuplicatesRemoved"
      },
      "name": "Read Processed Sheet",
      "type": "n8n-nodes-base.spreadsheetFile",
      "typeVersion": 1,
      "position": [1120, 300]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "{{$json[$node['Start Workflow'].json['finalEmailCol']]}}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "name": "Filter Non-Blank Emails",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [1340, 300]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "pythonCode": "import pandas as pd\\nimport unicodedata\\nimport re\\n\\ndf = pd.DataFrame($input.all())\\nemail_col = $node['Start Workflow'].json['finalEmailCol']\\nfirst_col = $node['Start Workflow'].json['firstNameCol']\\nlast_col = $node['Start Workflow'].json['lastNameCol']\\n\\ndf['Email Domain'] = df[email_col].str.split('@').str[1]\\ndef clean_name(name):\\n    if pd.isna(name): return ''\\n    name = unicodedata.normalize('NFKD', name).encode('ASCII', 'ignore').decode('ASCII')\\n    return re.sub(r'[^\\\\w\\\\s-]', '', name).lower()\\n\\ndf['First Name Trimmed'] = df[first_col].apply(clean_name)\\ndf['Last Name Trimmed'] = df[last_col].apply(clean_name)\\nreturn df.to_dict(orient='records')"
      },
      "name": "Process Emails",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [1560, 300]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "pythonCode": "import pandas as pd\\n\\ndf = pd.DataFrame($input.all())\\nemail_col = $node['Start Workflow'].json['finalEmailCol']\\npatterns = {\\n    'first.last': lambda row: f\\\"{row['First Name Trimmed']}.{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'firstlast': lambda row: f\\\"{row['First Name Trimmed']}{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'first_last': lambda row: f\\\"{row['First Name Trimmed']}_{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'flast': lambda row: f\\\"{row['First Name Trimmed'][0]}{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'firstl': lambda row: f\\\"{row['First Name Trimmed']}{row['Last Name Trimmed'][0]}@{row['Email Domain']}\\\",\\n    'f_last': lambda row: f\\\"{row['First Name Trimmed'][0]}_{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'first': lambda row: f\\\"{row['First Name Trimmed']}@{row['Email Domain']}\\\",\\n    'last': lambda row: f\\\"{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'lastf': lambda row: f\\\"{row['Last Name Trimmed']}{row['First Name Trimmed'][0]}@{row['Email Domain']}\\\",\\n    'first-last': lambda row: f\\\"{row['First Name Trimmed']}-{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'first-l': lambda row: f\\\"{row['First Name Trimmed']}-{row['Last Name Trimmed'][0]}@{row['Email Domain']}\\\",\\n    'f-last': lambda row: f\\\"{row['First Name Trimmed'][0]}-{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'last.first': lambda row: f\\\"{row['Last Name Trimmed']}.{row['First Name Trimmed']}@{row['Email Domain']}\\\",\\n    'l.first': lambda row: f\\\"{row['Last Name Trimmed'][0]}.{row['First Name Trimmed']}@{row['Email Domain']}\\\",\\n    'flast3': lambda row: f\\\"{row['First Name Trimmed'][0]}{row['Last Name Trimmed'][-3:]}@{row['Email Domain']}\\\",\\n    'firstlastfr4': lambda row: f\\\"{row['First Name Trimmed']}{row['Last Name Trimmed'][:4]}@{row['Email Domain']}\\\",\\n    'first_l': lambda row: f\\\"{row['First Name Trimmed']}_{row['Last Name Trimmed'][0]}@{row['Email Domain']}\\\",\\n    'fl': lambda row: f\\\"{row['First Name Trimmed'][0]}{row['Last Name Trimmed'][0]}@{row['Email Domain']}\\\",\\n    'lf': lambda row: f\\\"{row['Last Name Trimmed'][0]}{row['First Name Trimmed'][0]}@{row['Email Domain']}\\\",\\n    'f.last': lambda row: f\\\"{row['First Name Trimmed'][0]}.{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'firs.last': lambda row: f\\\"{row['First Name Trimmed'][:4] if len(row['First Name Trimmed']) >= 4 else row['First Name Trimmed']}.{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'firs-last': lambda row: f\\\"{row['First Name Trimmed'][:4] if len(row['First Name Trimmed']) >= 4 else row['First Name Trimmed']}-{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'firs_last': lambda row: f\\\"{row['First Name Trimmed'][:4] if len(row['First Name Trimmed']) >= 4 else row['First Name Trimmed']}_{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'first.las': lambda row: f\\\"{row['First Name Trimmed']}.{row['Last Name Trimmed'][:4] if len(row['Last Name Trimmed']) >= 4 else row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'first-las': lambda row: f\\\"{row['First Name Trimmed']}-{row['Last Name Trimmed'][:4] if len(row['Last Name Trimmed']) >= 4 else row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'first_las': lambda row: f\\\"{row['First Name Trimmed']}_{row['Last Name Trimmed'][:4] if len(row['Last Name Trimmed']) >= 4 else row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'firslast': lambda row: f\\\"{row['First Name Trimmed'][:4] if len(row['First Name Trimmed']) >= 4 else row['First Name Trimmed']}{row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'flas': lambda row: f\\\"{row['First Name Trimmed'][0]}{row['Last Name Trimmed'][:4] if len(row['Last Name Trimmed']) >= 4 else row['Last Name Trimmed']}@{row['Email Domain']}\\\",\\n    'l-first': lambda row: f\\\"{row['Last Name Trimmed'][0]}-{row['First Name Trimmed']}@{row['Email Domain']}\\\",\\n    'l_first': lambda row: f\\\"{row['Last Name Trimmed'][0]}_{row['First Name Trimmed']}@{row['Email Domain']}\\\",\\n    'last_first': lambda row: f\\\"{row['Last Name Trimmed']}_{row['First Name Trimmed']}@{row['Email Domain']}\\\",\\n    'last-firs': lambda row: f\\\"{row['Last Name Trimmed']}-{row['First Name Trimmed'][:4] if len(row['First Name Trimmed']) >= 4 else row['First Name Trimmed']}@{row['Email Domain']}\\\",\\n    'last_firs': lambda row: f\\\"{row['Last Name Trimmed']}_{row['First Name Trimmed'][:4] if len(row['First Name Trimmed']) >= 4 else row['First Name Trimmed']}@{row['Email Domain']}\\\",\\n    'lastl': lambda row: f\\\"{row['Last Name Trimmed']}{row['Last Name Trimmed'][0]}@{row['Email Domain']}\\\",\\n    'firs': lambda row: f\\\"{row['First Name Trimmed
